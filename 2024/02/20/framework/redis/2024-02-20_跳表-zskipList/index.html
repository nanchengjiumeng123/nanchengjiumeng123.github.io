

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Yang Xin">
  <meta name="keywords" content="">
  
    <meta name="description" content="1.跳跃表概述 跳跃表（skiplist）是一种随机化的数据， 由 William Pugh 在论文《Skip lists: a probabilistic alternative to balanced trees》中提出， 跳跃表以有序的方式在层次化的链表中保存元素， 效率和平衡树媲美 —— 查找、删除、添加等操作都可以在对数期望时间下完成， 并且比起平衡树来说， 跳跃表的实现要简单直观得多。">
<meta property="og:type" content="article">
<meta property="og:title" content="跳跃表-zskipList">
<meta property="og:url" content="https://nanchengjiumeng123.top/2024/02/20/framework/redis/2024-02-20_%E8%B7%B3%E8%A1%A8-zskipList/index.html">
<meta property="og:site_name" content="nanchengjiumeng123.top">
<meta property="og:description" content="1.跳跃表概述 跳跃表（skiplist）是一种随机化的数据， 由 William Pugh 在论文《Skip lists: a probabilistic alternative to balanced trees》中提出， 跳跃表以有序的方式在层次化的链表中保存元素， 效率和平衡树媲美 —— 查找、删除、添加等操作都可以在对数期望时间下完成， 并且比起平衡树来说， 跳跃表的实现要简单直观得多。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/java_se/throwable/mmexport1664532258070.jpg">
<meta property="article:published_time" content="2024-02-20T02:51:33.000Z">
<meta property="article:modified_time" content="2024-05-13T06:08:05.017Z">
<meta property="article:author" content="Yang Xin">
<meta property="article:tag" content="zskipList">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/java_se/throwable/mmexport1664532258070.jpg">
  
  
  
  <title>跳跃表-zskipList - nanchengjiumeng123.top</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"nanchengjiumeng123.top","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":100,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"gtag":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>wangwang&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/java_se/throwable/mmexport1664532258070.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="跳跃表-zskipList"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-02-20 10:51" pubdate>
          2024年2月20日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          5.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          44 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">跳跃表-zskipList</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="跳跃表概述">1.跳跃表概述</h1>
<p>跳跃表（<a
target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Skip_list">skiplist</a>）是一种随机化的数据，
由 William Pugh 在论文<a
target="_blank" rel="noopener" href="http://www.cl.cam.ac.uk/teaching/0506/Algorithms/skiplists.pdf">《Skip
lists: a probabilistic alternative to balanced trees》</a>中提出，
跳跃表以有序的方式在层次化的链表中保存元素， 效率和平衡树媲美 ——
查找、删除、添加等操作都可以在对数期望时间下完成， 并且比起平衡树来说，
跳跃表的实现要简单直观得多。</p>
<p>跳表（skip list）对表的是平衡树（AVL Tree）和 二分查找，是一种
插入/删除/搜索 都是 <em>O</em>(<em>l<strong>o</strong>gn</em>)
的数据结构。</p>
<p>以下是个典型的跳跃表例子（图片来自<a
target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/File:Skip_list.svg">维基百科</a>）：</p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/skiplist.png" srcset="/img/loading.gif" lazyload /></p>
<p>从图中可以看到， 跳跃表主要由以下部分构成：</p>
<ul>
<li>表头（head）：负责维护跳跃表的节点指针。</li>
<li>跳跃表节点：保存着元素值，以及多个层。</li>
<li>层：保存着指向其他元素的指针。高层的指针越过的元素数量大于等于低层的指针，为了提高查找的效率，程序总是从高层先开始访问，然后随着元素值范围的缩小，慢慢降低层次。</li>
<li>表尾：全部由 <code>NULL</code> 组成，表示跳跃表的末尾。</li>
</ul>
<h1 id="如何给有序链表加速">2.如何给有序链表加速</h1>
<p>一开始就讲跳表肯定是晦涩难懂的，我们已经了解了跳表的基础定义，我们先了解一下有序链表。看看有序链表是如何“加速”的。</p>
<blockquote>
<p>有序链表是所有元素以递增或递减方式有序排列的数据结构，其中每个节点都指向下个节点的next指针，最后一个节点的next指针指向NULL。</p>
</blockquote>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317165802204.png" srcset="/img/loading.gif" lazyload /></p>
<p>如上，我们有一个单向有序链表，如果要查询31的元素，需要从第一个元素开始依次向后查询、比较才可以找到，找到顺序为1-&gt;8-&gt;10-&gt;11-&gt;20-&gt;26-&gt;31，共6次比较，时间复杂度为<em>O(N)。有序链表的插入和删除操作都需要先找到合适的位置在修改next指针，修改操作基本不耗费时间，所以插入、删除、修改有序链表的耗时主要在查找元素上。</em></p>
<p><font size=4><strong>如何进行简单优化？可以让它的查询时间复杂度变低，也就是加速它的查询</strong>。</font></p>
<blockquote>
<p>一般来说这种加速的方式的话，就类似于星际穿越里面这有点玄学，但是你一定要记住一个概念就行了，一维的数据结构要加速的话，经常采用的方式就是升维也就是说变成二维。为什么要多一层维度，因为你多了一个维度之后，就会有多一级的信息在里面，这样多一级的信息就可以帮助你可以很快地得到一维里面你必须挨个走才能走到的那些元素</p>
</blockquote>
<p><font size=4><strong>添加第一级索引</strong></font></p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317172225269.png" srcset="/img/loading.gif" lazyload /></p>
<p>具体我们来看上图，在原始链表的情况下，我们再增加一个维度，也就是在上面再增加一层索引，我们叫做第一级索引，那么第一级索引的话就不是指向它元素的
next 元素了，而是指向它的 next next ，也就是说你可以理解为 next + 1
就行了，所以第一级索引的话就是第一个元素，马上第三个元素、第五个元素、第七个元素。</p>
<ul>
<li><p>这里你就会发现如果你要找26的话，我们怎么办？我们这么查找，先查找第一级索引看有没有1
10 26 ，如果有那就说明 26
存在这个链表里面是存在的，说明我们查询到了。</p></li>
<li><p>我们再看要查另一个元素，比如说
31，我们怎么走？还是先找第一级，31是大于 1 的，所以后继往后到达 10
索引的值，31 是大于 10 的，继续往后到了 10 ，31 也大 26
的，再继续往后发现 60 大于 31 了。说明 31 是存在于 26 和 60
这两个索引之间的元素里面的，那么这个时候从第一级元素向下走到原始的链表了，从对应的位置挨个找就会发现
31 找到了，说明 31 也是存在的。</p></li>
</ul>
<p><font size=4><strong>添加第二级索引</strong></font></p>
<p>那么有的朋友可能就会想了，你加一级索引的话，每次相当于步伐加 2
了，但是它的速度的话也就是比原来稍微快了一点，能不能更快呢？</p>
<p>同理可得，在第一级索引的基础上，我们把它当作是一个原始链表一样，往上再加一级索引，也就是说每次针对第一级索引走两步。那么它相等于原始链表相当于每次就走了四步。对不对，就乘于
2，那这样的话，速度就更加高效了。</p>
<ul>
<li>比如我举个例子要查31，先找 1，31 比 1要大，再找 26 ，这时候你会发现
31 也是比 26 大的，所以 26
这里的话就必须向下再走一级索引了，走到第一级索引的 26 来，再类似于之前
26 和 60 之间，然后再走到下一层， 这样一直走下来找到31。</li>
</ul>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317172847010.png" srcset="/img/loading.gif" lazyload /></p>
<p><font size=4><strong>添加多级索引</strong></font></p>
<p>以此类推，增加多级索引</p>
<p>假设有五级索引的这么一个原始链表，那么我们要查一个元素，比如说要查 62
元素或者中间元素，就类似于下图，一级一级一级一级走下来，最后的话就可以查到我们需要的62这个元素。当然的话你最后查到原始链表，你会发现比如说是我们要查63或者61，原始链表里面没有，我们就说元素不存在，在我们这个有序的链表里面，也就是说在跳表里面查不到这么一个元素。</p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317175020869.png" srcset="/img/loading.gif" lazyload /></p>
<p><em>如果我们将有序链表的部分节点分层，每一层都是一个有序链表。在查找时优先从最高层开始向后查找，当到达某节点时，如果next节点值大于要查找的值或next指针指向NULL，则从当前节点下降一成继续向后查找，这样是否可以提升查询效率呢？</em></p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317175241953.png" srcset="/img/loading.gif" lazyload /></p>
<p>使用分层有序链表，比如我们查找值为31的节点时，查找步骤如下：</p>
<ol type="1">
<li>从最高层第2层开始查找，1节点比31值要小，继续向后比较。</li>
<li>10节点比31节点要小，继续向后比较，这时会发现第2层10节点的next指针是指向NULL，所以在10节点就开始需要下降一层到第1层并继续向后查找节点进行比较。</li>
<li>在下降到第1层中，10节点的值比31要小，继续向后比较，第1层10节点的next指针指向26，26比31要小，继续向后比较，第1层26节点的next指针指向60，60比31要大，需要下降一层继续向后比较。</li>
<li>最后下降到了第0层，第0层的26节点的next指针指向31，31为我们要找的节点，节点被找到。</li>
</ol>
<h1 id="redis跳跃表">3.redis跳跃表</h1>
<p>为了满足自身的功能需要， Redis 基于 William Pugh
论文中描述的跳跃表进行了以下修改：</p>
<ol type="1">
<li>允许重复的 <code>score</code> 值：多个不同的 <code>member</code> 的
<code>score</code> 值可以相同。</li>
<li>进行对比操作时，不仅要检查 <code>score</code> 值，还要检查
<code>member</code> ：当 <code>score</code> 值可以重复时，单靠
<code>score</code> 值无法判断一个元素的身份，所以需要连
<code>member</code> 域都一并检查才行。</li>
<li>每个节点都带有一个高度为 1
层的后退指针，用于从表尾方向向表头方向迭代：当执行 <a
target="_blank" rel="noopener" href="http://redis.readthedocs.org/en/latest/sorted_set/zrevrange.html#zrevrange">ZREVRANGE</a>
或 <a
target="_blank" rel="noopener" href="http://redis.readthedocs.org/en/latest/sorted_set/zrevrangebyscore.html#zrevrangebyscore">ZREVRANGEBYSCORE</a>
这类以逆序处理有序集的命令时，就会用到这个属性。</li>
</ol>
<h2 id="zskiplist">3.1 zskiplist</h2>
<p>这个修改版的跳跃表由 <code>redis.h/zskiplist</code> 结构定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 跳跃表链表结构</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">zskiplist</span> &#123;</span><br>    <span class="hljs-comment">// 表头节点和表尾节点</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">zskiplistNode</span> *<span class="hljs-title">header</span>, *<span class="hljs-title">tail</span>;</span><br><br>    <span class="hljs-comment">// 表中节点的数量</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> length;<br><br>    <span class="hljs-comment">// 表中层数最大的节点的层数</span><br>    <span class="hljs-type">int</span> level;<br><br>&#125; zskiplis<br></code></pre></td></tr></table></figure>
<p>该结构体属性如下：</p>
<ul>
<li>header：指向跳跃表头节点。头节点时跳跃表的特殊节点，他的level是固定数组元素个数为32个，头节点不存储任何score和obj，level也不计入跳跃表的高度，头节点在初始化时，score值为0，ele值为NULL，32个元素的forward值都指向NULL，span为0.</li>
<li>tail：指向跳跃表尾节点。</li>
<li>length：跳跃表长度，表示第0层除头节点以外的所有节点总数。</li>
<li>level：跳跃表高度，除头节点外，其他节点层数最高的即为跳跃表高度。</li>
</ul>
<p>注意表头节点和其他节点的构造是一样的：表头节点也有后退指针、分值和成员对象，不过表头节点的这些属性都不会被用到。</p>
<h2 id="zskiplistnode">3.2 zskiplistNode</h2>
<p>跳跃表的节点由 <code>redis.h/zskiplistNode</code> 定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">zskiplistNode</span> &#123;</span><br><br>    <span class="hljs-comment">// member 对象</span><br>    robj *obj;<br><br>    <span class="hljs-comment">// 分值</span><br>    <span class="hljs-type">double</span> score;<br><br>    <span class="hljs-comment">// 后退指针</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">zskiplistNode</span> *<span class="hljs-title">backward</span>;</span><br><br>    <span class="hljs-comment">// 层</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">zskiplistLevel</span> &#123;</span><br><br>        <span class="hljs-comment">// 前进指针</span><br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">zskiplistNode</span> *<span class="hljs-title">forward</span>;</span><br><br>        <span class="hljs-comment">// 这个层跨越的节点数量</span><br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> span;<br><br>    &#125; level[];<br><br>&#125; zskiplistNode;<br></code></pre></td></tr></table></figure>
<ul>
<li>score：是一个double类型的浮点数，用户存储有序链表节点的分值，跳跃表中的所有节点都按分值从小到大来排序。</li>
<li>obj：为节点的成员对象，指向一个字符串对象，而字符串对象则保存着一个SDS值。</li>
<li>backward：后退指针，用于从从表尾向表头遍历跳跃表访问节点时使用。指向跳跃表当前节点的最底层节点的前一个节点，头节点和第一个节点的backward指向NULL。</li>
<li>层(level)：为动态柔性数组，数组可以包含多个元素，每个元素都包含一个指向其他节点的指针。每个节点层高不同对应的数组大小也不同，每次创建一个新跳跃表节点的时候，根据幂次定律
(power law，值越大出现的概率越小）
随机生成一个1～32的值，一般来说，层的数量越多，访问其他节点的速度就越快。</li>
</ul>
<p>这level数组中的每项元素包含以下两个元素：</p>
<ul>
<li>forward：指向本层下一个节点，每个层都有一个指向表尾方向的前进指针
(level[i]-&gt;forward属性），用于从表头向表尾方向访问节点，尾节点的forward指向NULL。</li>
<li>span：层的跨度 (level[i]-&gt;span属性）
用于记录两个节点之间的距离，即forward指向的节点于本节点之间的元素个数，span值越大，说明跳过的节点个数越多。</li>
</ul>
<p>以下是操作这两个数据结构的 API ，API 的用途与相应的算法复杂度：</p>
<table>

<thead>
<tr class="header">
<th style="text-align: left;">函数</th>
<th style="text-align: left;">作用</th>
<th style="text-align: left;">复杂度</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>zslCreateNode</code></td>
<td style="text-align: left;">创建并返回一个新的跳跃表节点</td>
<td style="text-align: left;">最坏 O(1)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>zslFreeNode</code></td>
<td style="text-align: left;">释放给定的跳跃表节点</td>
<td style="text-align: left;">最坏 O(1)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>zslCreate</code></td>
<td style="text-align: left;">创建并初始化一个新的跳跃表</td>
<td style="text-align: left;">最坏 O(1)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>zslFree</code></td>
<td style="text-align: left;">释放给定的跳跃表</td>
<td style="text-align: left;">最坏 O(N)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>zslInsert</code></td>
<td style="text-align: left;">将一个包含给定 <code>score</code> 和
<code>member</code> 的新节点添加到跳跃表中</td>
<td style="text-align: left;">最坏 O(N)平均 O(logN)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>zslDeleteNode</code></td>
<td style="text-align: left;">删除给定的跳跃表节点</td>
<td style="text-align: left;">最坏 O(N)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>zslDelete</code></td>
<td style="text-align: left;">删除匹配给定 <code>member</code> 和
<code>score</code> 的元素</td>
<td style="text-align: left;">最坏 O(N) 平均 O(logN)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>zslFirstInRange</code></td>
<td style="text-align: left;">找到跳跃表中第一个符合给定范围的元素</td>
<td style="text-align: left;">最坏 O(N) 平均 O(logN)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>zslLastInRange</code></td>
<td
style="text-align: left;">找到跳跃表中最后一个符合给定范围的元素</td>
<td style="text-align: left;">最坏 O(N) 平均 O(logN)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>zslDeleteRangeByScore</code></td>
<td style="text-align: left;">删除 <code>score</code>
值在给定范围内的所有节点</td>
<td style="text-align: left;">最坏 O(N^2)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>zslDeleteRangeByRank</code></td>
<td style="text-align: left;">删除给定排序范围内的所有节点</td>
<td style="text-align: left;">最坏 O(N^2)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>zslGetRank</code></td>
<td style="text-align: left;">返回目标元素在有序集中的排位</td>
<td style="text-align: left;">最坏 O(N) 平均 O(logN)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>zslGetElementByRank</code></td>
<td style="text-align: left;">根据给定排位，返回该排位上的元素节点</td>
<td style="text-align: left;">最坏 O(N) 平均 O(logN)</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Redis 跳跃表默认允许最大的层数是 32</strong>，被源码中
ZSKIPLIST_MAXLEVEL 定义。</p>
</blockquote>
<h2 id="redis跳跃表实现">3.3 redis跳跃表实现</h2>
<p>Redis 的跳跃表由 <code>redis.h/zskiplistNode</code> 和
<code>redis.h/zskiplist</code> 两个结构定义， 其中
<code>zskiplistNode</code> 结构用于表示跳跃表节点， 而
<code>zskiplist</code> 结构则用于保存跳跃表节点的相关信息，
比如节点的数量， 以及指向表头节点和表尾节点的指针， 等等。</p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317211111126.png" srcset="/img/loading.gif" lazyload /></p>
<p>上图展示了一个跳跃表示zskiplist 结构，该结构包含以下属性：</p>
<ul>
<li><code>header</code> ：指向跳跃表的表头节点。</li>
<li><code>tail</code> ：指向跳跃表的表尾节点。</li>
<li><code>level</code>
：记录目前跳跃表内，层数最大的那个节点的层数（表头节点的层数不计算在内）。</li>
<li><code>length</code>
：记录跳跃表的长度，也即是，跳跃表目前包含节点的数量（表头节点不计算在内）。</li>
</ul>
<p>位于 <code>zskiplist</code> 结构右方的是四个
<code>zskiplistNode</code> 结构， 该结构包含以下属性：</p>
<ul>
<li>层（level）：节点中用 <code>L1</code> 、 <code>L2</code> 、
<code>L3</code> 等字样标记节点的各个层， <code>L1</code> 代表第一层，
<code>L2</code>
代表第二层，以此类推。每个层都带有两个属性：前进指针和跨度。前进指针用于访问位于表尾方向的其他节点，而跨度则记录了前进指针所指向节点和当前节点的距离。在上面的图片中，连线上带有数字的箭头就代表前进指针，而那个数字就是跨度。当程序从表头向表尾进行遍历时，访问会沿着层的前进指针进行。</li>
<li>后退（backward）指针：节点中用 <code>BW</code>
字样标记节点的后退指针，它指向位于当前节点的前一个节点。后退指针在程序从表尾向表头遍历时使用。</li>
<li>分值（score）：各个节点中的 <code>1.0</code> 、 <code>2.0</code> 和
<code>3.0</code>
是节点所保存的分值。在跳跃表中，节点按各自所保存的分值从小到大排列。</li>
<li>成员对象（obj）：各个节点中的 <code>o1</code> 、 <code>o2</code> 和
<code>o3</code> 是节点所保存的成员对象。</li>
</ul>
<h4 id="层">层</h4>
<p>跳跃表节点的 level
数组可以包含多个元素，每个元素都包含一个指向其他节点的指针，程序可以通过这些层来加快访问其他节点的速度，一般来说，层的数量越多，访问其他节点的速度就越快。</p>
<p>每次创建一个新跳跃表节点的时候， 程序都根据幂次定律 （<a
href="https://link.juejin.cn?target=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FPower_law">power
law</a>，越大的数出现的概率越小） 随机生成一个介于 <code>1</code> 和
<code>32</code> 之间的值作为 <code>level</code> 数组的大小，
这个大小就是层的“高度”。</p>
<p>下图分别展示了三个高度为 <code>1</code> 层、 <code>3</code> 层和
<code>5</code> 层的节点， 因为 C 语言的数组索引总是从 <code>0</code>
开始的， 所以节点的第一层是 <code>level[0]</code> ， 而第二层是
<code>level[1]</code> ， 以此类推。</p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317211216113.png" srcset="/img/loading.gif" lazyload /></p>
<h4 id="前进指针">前进指针</h4>
<p>每个层都有一个指向表尾方向的前进指针（<code>level[i].forward</code>
属性）， 用于从表头向表尾方向访问节点。</p>
<p>上图用虚线表示出了程序从表头向表尾方向，
遍历跳跃表中所有节点的路径：</p>
<ol type="1">
<li>迭代程序首先访问跳跃表的第一个节点（表头），
然后从第四层的前进指针移动到表中的第二个节点。</li>
<li>在第二个节点时，
程序沿着第二层的前进指针移动到表中的第三个节点。</li>
<li>在第三个节点时，
程序同样沿着第二层的前进指针移动到表中的第四个节点。</li>
<li>当程序再次沿着第四个节点的前进指针移动时， 它碰到一个
<code>NULL</code> ， 程序知道这时已经到达了跳跃表的表尾，
于是结束这次遍历。</li>
</ol>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317211242486.png" srcset="/img/loading.gif" lazyload /></p>
<h4 id="跨度">跨度</h4>
<p>层的跨度（<code>level[i].span</code>
属性）用于记录两个节点之间的距离：</p>
<ul>
<li>两个节点之间的跨度越大， 它们相距得就越远。</li>
<li>指向 <code>NULL</code> 的所有前进指针的跨度都为 <code>0</code> ，
因为它们没有连向任何节点。</li>
</ul>
<p>初看上去， 很容易以为跨度和遍历操作有关， 但实际上并不是这样 ——
遍历操作只使用前进指针就可以完成了，
跨度实际上是用来计算排位（rank）的： 在查找某个节点的过程中，
将沿途访问过的所有层的跨度累计起来，
得到的结果就是目标节点在跳跃表中的排位。</p>
<p>举个例子， 如下用虚线标记了在跳跃表中查找分值为 <code>3.0</code> 、
成员对象为 <code>o3</code> 的节点时， 沿途经历的层：
查找的过程只经过了一个层， 并且层的跨度为 <code>3</code> ，
所以目标节点在跳跃表中的排位为 <code>3</code> 。</p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317211322796.png" srcset="/img/loading.gif" lazyload /></p>
<p>再举个例子， 如下用虚线标记了在跳跃表中查找分值为 <code>2.0</code> 、
成员对象为 <code>o2</code> 的节点时， 沿途经历的层：
在查找节点的过程中， 程序经过了两个跨度为 <code>1</code> 的节点，
因此可以计算出， 目标节点在跳跃表中的排位为 2 。</p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317211430979.png" srcset="/img/loading.gif" lazyload /></p>
<h4 id="后退指针">后退指针</h4>
<p>节点的后退指针（<code>backward</code>
属性）用于从表尾向表头方向访问节点：
跟可以一次跳过多个节点的前进指针不同， 因为每个节点只有一个后退指针，
所以每次只能后退至前一个节点。</p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317211445751.png" srcset="/img/loading.gif" lazyload /></p>
<p>上图用虚线展示了如果从表尾向表头遍历跳跃表中的所有节点：
程序首先通过跳跃表的 <code>tail</code> 指针访问表尾节点，
然后通过后退指针访问倒数第二个节点，
之后再沿着后退指针访问倒数第三个节点， 再之后遇到指向 <code>NULL</code>
的后退指针， 于是访问结束。</p>
<h4 id="分值和成员">分值和成员</h4>
<ul>
<li>节点的分值（<code>score</code> 属性）是一个 <code>double</code>
类型的浮点数， 跳跃表中的所有节点都按分值从小到大来排序。</li>
<li>节点的成员对象（<code>obj</code> 属性）是一个指针，
它指向一个字符串对象， 而字符串对象则保存着一个 SDS（简单动态字符串）
值。</li>
</ul>
<p>在同一个跳跃表中， 各个节点保存的成员对象必须是唯一的，
但是多个节点保存的分值却可以是相同的：
分值相同的节点将按照成员对象在字典序中的大小来进行排序，
成员对象较小的节点会排在前面（靠近表头的方向），
而成员对象较大的节点则会排在后面（靠近表尾的方向）。</p>
<p>举个例子， 在下图所示的跳跃表中， 三个跳跃表节点都保存了相同的分值
<code>10086.0</code> ， 但保存成员对象 <code>o1</code>
的节点却排在保存成员对象 <code>o2</code> 和 <code>o3</code> 的节点之前，
而保存成员对象 <code>o2</code> 的节点又排在保存成员对象 <code>o3</code>
的节点之前， 由此可见， <code>o1</code> 、 <code>o2</code> 、
<code>o3</code> 三个成员对象在字典中的排序为
<code>o1 &lt;= o2 &lt;= o3</code> 。</p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317211458874.png" srcset="/img/loading.gif" lazyload /></p>
<h3 id="跳跃表">跳跃表</h3>
<p>虽然仅靠多个跳跃表节点就可以组成一个跳跃表， 如下图 所示：</p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317211508748.png" srcset="/img/loading.gif" lazyload /></p>
<p>但通过使用一个 <code>zskiplist</code> 结构来持有这些节点，
程序可以更方便地对整个跳跃表进行处理，
比如快速访问跳跃表的表头节点和表尾节点，
又或者快速地获取跳跃表节点的数量（也即是跳跃表的长度）等信息，
如下所示：</p>
<p><img
src="https://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/redis/image-20240317211528404.png" srcset="/img/loading.gif" lazyload /></p>
<h1 id="问题">4. 问题</h1>
<p>为啥 redis 使用跳表(skiplist)而不是使用 red-black？</p>
<ol type="1">
<li>skiplist的复杂度和红黑树一样，而且实现起来更简单。</li>
<li>在并发环境下skiplist有另外一个优势，红黑树在插入和删除的时候可能需要做一些rebalance的操作，这样的操作可能会涉及到整个树的其他部分，而skiplist的操作显然更加局部性一些，锁需要盯住的节点更少，因此在这样的情况下性能好一些。</li>
</ol>
<p>附：开发者说的为什么选用skiplist <a
href="https://link.juejin.cn/?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D1171423">The
Skip list</a></p>
<blockquote>
<p>There are a few reasons:</p>
<p>They are not very memory intensive. It's up to you basically.
Changing parameters about the probability of a node to have a given
number of levels will make then less memory intensive than btrees. A
sorted set is often target of many ZRANGE or ZREVRANGE operations, that
is, traversing the skip list as a linked list. With this operation the
cache locality of skip lists is at least as good as with other kind of
balanced trees. They are simpler to implement, debug, and so forth. For
instance thanks to the skip list simplicity I received a patch (already
in Redis master) with augmented skip lists implementing ZRANK in
O(log(N)). It required little changes to the code. About the Append Only
durability &amp; speed, I don't think it is a good idea to optimize
Redis at cost of more code and more complexity for a use case that IMHO
should be rare for the Redis target (fsync() at every command). Almost
no one is using this feature even with ACID SQL databases, as the
performance hint is big anyway.</p>
<p>About threads: our experience shows that Redis is mostly I/O bound.
I'm using threads to serve things from Virtual Memory. The long term
solution to exploit all the cores, assuming your link is so fast that
you can saturate a single core, is running multiple instances of Redis
(no locks, almost fully scalable linearly with number of cores), and
using the "Redis Cluster" solution that I plan to develop in the
future.</p>
</blockquote>
<h1 id="总结">5. 总结</h1>
<ul>
<li>跳跃表是有序集合的底层实现之一， 除此之外它在 Redis
中没有其他应用。</li>
<li>Redis 的跳跃表实现由 <code>zskiplist</code> 和
<code>zskiplistNode</code> 两个结构组成， 其中 <code>zskiplist</code>
用于保存跳跃表信息（比如表头节点、表尾节点、长度）， 而
<code>zskiplistNode</code> 则用于表示跳跃表节点。</li>
<li>每个跳跃表节点的层高都是 <code>1</code> 至 <code>32</code>
之间的随机数。</li>
<li>在同一个跳跃表中， 多个节点可以包含相同的分值，
但每个节点的成员对象必须是唯一的。</li>
<li>跳跃表中的节点按照分值大小进行排序， 当分值相同时，
节点按照成员对象的大小进行排序。</li>
</ul>
<h1 id="read-more">6.Read more</h1>
<p>:lollipop::http://redisbook.com/preview/skiplist/datastruct.html</p>
<p>:lollipop::https://juejin.cn/post/689302628126206591496</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Redis/" class="category-chain-item">Redis</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/zskipList/" class="print-no-link">#zskipList</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>跳跃表-zskipList</div>
      <div>https://nanchengjiumeng123.top/2024/02/20/framework/redis/2024-02-20_跳表-zskipList/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Yang Xin</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年2月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/01/30/java_se/2022-05-13_%E5%BC%82%E5%B8%B8/" title="异常">
                        <span class="hidden-mobile">异常</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <span>Blog</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":200,"height":400},"mobile":{"show":true},"log":false});</script></body>
</html>
