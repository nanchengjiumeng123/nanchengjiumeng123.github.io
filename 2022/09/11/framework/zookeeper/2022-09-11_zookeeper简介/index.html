

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Yang Xin">
  <meta name="keywords" content="">
  
    <meta name="description" content="1. What is ZooKeeper? ZooKeeper 是 Apache 软件基金会的一个软件项目，它为大型分布式计算提供开源的分布式配置服务、同步服务和命名注册。设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用。 一个典型的分布式数据一致性的解决方案，分布式应用程序可以基于它实现诸如数据发布&#x2F;订阅、负载均衡、命名">
<meta property="og:type" content="article">
<meta property="og:title" content="zookeeper简介">
<meta property="og:url" content="https://nanchengjiumeng123.top/2022/09/11/framework/zookeeper/2022-09-11_zookeeper%E7%AE%80%E4%BB%8B/index.html">
<meta property="og:site_name" content="nanchengjiumeng123.top">
<meta property="og:description" content="1. What is ZooKeeper? ZooKeeper 是 Apache 软件基金会的一个软件项目，它为大型分布式计算提供开源的分布式配置服务、同步服务和命名注册。设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用。 一个典型的分布式数据一致性的解决方案，分布式应用程序可以基于它实现诸如数据发布&#x2F;订阅、负载均衡、命名">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/zookeeper/IMG_5270(20220808-123702).jpg">
<meta property="article:published_time" content="2022-09-11T01:11:22.000Z">
<meta property="article:modified_time" content="2024-05-13T05:26:08.713Z">
<meta property="article:author" content="Yang Xin">
<meta property="article:tag" content="Zookeeper">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/zookeeper/IMG_5270(20220808-123702).jpg">
  
  
  
  <title>zookeeper简介 - nanchengjiumeng123.top</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"nanchengjiumeng123.top","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":100,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"gtag":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>wangwang&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('http://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/zookeeper/IMG_5270(20220808-123702).jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="zookeeper简介"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-09-11 09:11" pubdate>
          2022年9月11日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          4.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          36 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">zookeeper简介</h1>
            
            
              <div class="markdown-body">
                
                <p><img
src="http://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/zookeeper/image-20230306150013020.png" srcset="/img/loading.gif" lazyload /></p>
<h1 id="what-is-zookeeper">1. What is ZooKeeper?</h1>
<p>ZooKeeper 是 Apache
软件基金会的一个软件项目，它为大型分布式计算提供开源的分布式配置服务、同步服务和命名注册。设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用。</p>
<p>一个典型的分布式数据一致性的解决方案，分布式应用程序可以基于它实现诸如数据发布/订阅、负载均衡、命名服务、分布式协调/通知、集群管理、Master
选举、分布式锁和分布式队列等功能。</p>
<p><a target="_blank" rel="noopener" href="https://zookeeper.apache.org/">Zookeeper官网:</a></p>
<p><a
target="_blank" rel="noopener" href="https://zookeeper.apache.org/doc/r3.6.0/zookeeperProgrammers.html">Zookeeper官方文档:</a></p>
<p>ZooKeeper is a centralized service for maintaining configuration
information, naming, providing distributed synchronization, and
providing group services. All of these kinds of services are used in
some form or another by distributed applications. Each time they are
implemented there is a lot of work that goes into fixing the bugs and
race conditions that are inevitable. Because of the difficulty of
implementing these kinds of services, applications initially usually
skimp on them, which make them brittle in the presence of change and
difficult to manage. Even when done correctly, different implementations
of these services lead to management complexity when the applications
are deployed.</p>
<p>Learn more about ZooKeeper on the <a
target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/Index">ZooKeeper
Wiki</a>.</p>
<blockquote>
<p>简而言之：ZooKeeper是一个用于维护配置信息、命名、提供分布式同步和提供组服务的集中式服务。</p>
</blockquote>
<h2 id="设计目标">1.2设计目标</h2>
<h3 id="zookeeper-is-simple">1.2.1 <strong>ZooKeeper is
simple</strong></h3>
<p>ZooKeeper
允许分布式进程通过类似于标准文件系统组织的共享分层命名空间相互协调。命名空间由数据寄存器组成——用
ZooKeeper 的说法称为
znodes——它们类似于文件和目录。与为存储而设计的典型文件系统不同，ZooKeeper
数据保存在内存中，这意味着 ZooKeeper 可以实现高吞吐量和低延迟数。</p>
<p>ZooKeeper
实现非常重视高性能、高可用性、严格有序的访问。<strong>ZooKeeper
的性能方面意味着它可以用于大型分布式系统。可靠性方面使其不会成为单点故障。严格的排序意味着可以在客户端实现复杂的同步原语</strong>。</p>
<h3 id="zookeeper-is-replicated.">1.2.2 <strong>ZooKeeper is
replicated.</strong></h3>
<p>就像它协调的分布式进程一样，ZooKeeper
本身旨在通过一组称为集成的主机进行复制。</p>
<figure>
<img
src="http://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/zookeeper/zkservice.jpg" srcset="/img/loading.gif" lazyload
alt="动物园管理员服务" />
<figcaption aria-hidden="true">动物园管理员服务</figcaption>
</figure>
<p>构成 ZooKeeper
服务的服务器必须相互了解。它们在内存中维护状态数据，以及持久存储中的事务日志和快照。只要大多数服务器可用，ZooKeeper
服务就可用。</p>
<p>客户端连接到单个 ZooKeeper 服务器。客户端维护一个 TCP
连接，通过它发送请求、获取响应、获取监视事件和发送心跳。如果与服务器的
TCP 连接中断，客户端将连接到另一台服务器。</p>
<h3 id="zookeeper-is-ordered">1.2.3 <strong>ZooKeeper is
ordered</strong></h3>
<p>ZooKeeper 用反映所有 ZooKeeper
事务顺序的数字标记每个更新。后续操作可以使用该顺序来实现更高级别的抽象，例如同步原语。</p>
<h3 id="zookeeper-is-fast">1.2.4 <strong>ZooKeeper is fast</strong></h3>
<p>它在“读主导”工作负载中特别快。ZooKeeper
应用程序在数千台机器上运行，它在读取比写入更常见的情况下表现最佳，比率约为
10:1。</p>
<h1 id="zookeeper安装">2.Zookeeper安装</h1>
<ul>
<li><a
target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/zookeeper-setup.html">Zookeeper安装</a></li>
<li><a
target="_blank" rel="noopener" href="https://blog.51cto.com/u_15856491/5815098">Zookeeper常见错误</a></li>
</ul>
<p><strong><em>本文省略Zookeeper安装具体教程，如果有兴趣查找以上资料进行安装。</em></strong></p>
<p>zoo.cfg相关参数</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># The number of milliseconds of each tick</span><br><span class="hljs-comment"># 这个时间是作为 Zookeeper 服务器之间或客户端与服务器之间维持心跳的时间间隔，也就是每个 tickTime 时间就会发送一个心跳，以毫秒为单位。</span><br><span class="hljs-attr">tickTime</span>=<span class="hljs-string">2000</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># The number of ticks that the initial </span><br><span class="hljs-comment"># synchronization phase can take</span><br><span class="hljs-comment"># 这个配置项是用来配置 Zookeeper 接受客户端（这里所说的客户端不是用户连接 Zookeeper 服务器的客户端，而是 Zookeeper 服务器集群中连接到 Leader 的 Follower 服务器）初始化连接时最长能忍受多少个心跳时间间隔数。当已经超过 10 个心跳的时间（也就是 tickTime）长度后 Zookeeper 服务器还没有收到客户端的返回信息，那么表明这个客户端连接失败。总的时间长度就是 52000=10 秒</span><br><span class="hljs-attr">initLimit</span>=<span class="hljs-string">10</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># The number of ticks that can pass between </span><br><span class="hljs-comment"># sending a request and getting an acknowledgement</span><br><span class="hljs-attr">syncLimit</span>=<span class="hljs-string">5</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># the directory where the snapshot is stored.</span><br><span class="hljs-comment"># do not use /tmp for storage, /tmp here is just </span><br><span class="hljs-comment"># example sakes.</span><br><span class="hljs-comment"># 顾名思义就是 Zookeeper 保存数据的目录，默认情况下</span><br><span class="hljs-attr">dataDir</span>=<span class="hljs-string">D:\software\zookeeper\apache-zookeeper-3.7.0\data</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">#Zookeeper 将写数据的日志文件保存在这个目录里。</span><br><span class="hljs-attr">dataLogDir</span>=<span class="hljs-string">D:\software\zookeeper\apache-zookeeper-3.7.0\log</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># the port at which the clients will connect</span><br><span class="hljs-comment"># 这个端口就是客户端连接 Zookeeper 服务器的端口，Zookeeper 会监听这个端口，接受客户端的访问请求</span><br><span class="hljs-attr">clientPort</span>=<span class="hljs-string">2181</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># the maximum number of client connections.</span><br><span class="hljs-comment"># increase this if you need to handle more clients</span><br><span class="hljs-comment">#maxClientCnxns=60</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Be sure to read the maintenance section of the </span><br><span class="hljs-comment"># administrator guide before turning on autopurge.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># The number of snapshots to retain in dataDir</span><br><span class="hljs-comment">#autopurge.snapRetainCount=3</span><br><span class="hljs-comment"># Purge task interval in hours</span><br><span class="hljs-comment"># Set to &quot;0&quot; to disable auto purge feature</span><br><span class="hljs-comment">#autopurge.purgeInterval=1</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">## Metrics Providers</span><br><span class="hljs-comment"># https://prometheus.io Metrics Exporter</span><br><span class="hljs-comment">#metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider</span><br><span class="hljs-comment">#metricsProvider.httpPort=7000</span><br><span class="hljs-comment">#metricsProvider.exportJvmInfo=true</span><br></code></pre></td></tr></table></figure>
<h1 id="zookeeper概念">3.Zookeeper概念</h1>
<h2 id="数据模型和分层命名空间">3.1 数据模型和分层命名空间</h2>
<p>ZooKeeper
中的数据模型是一种树形结构，非常像电脑中的文件系统，有一个根文件夹，下面还有很多子文件夹。ZooKeeper
的数据模型也具有一个固定的根节点（/），我们可以在根节点下创建子节点，并在子节点下继续创建下一级节点。ZooKeeper
树中的每一层级用斜杠（/）分隔开，且只能用绝对路径（如“get
/work/task1”）的方式查询 ZooKeeper
节点，而不能使用相对路径。具体的结构看看下面这张图：</p>
<figure>
<img
src="http://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/zookeeper/CgqCHl6yL9uAbpHYAABF_GHyGNc950.png" srcset="/img/loading.gif" lazyload
alt="image" />
<figcaption aria-hidden="true">image</figcaption>
</figure>
<blockquote>
<p>ZooKeeper
数据模型的结构与Unix文件系统很类似，每个节点称作一个ZNode，ZNode 是以
key-value 形式存在的。名称 key 由斜线 / 分割的一系列路径元素，zookeeper
名称空间中的每个节点都是由一个路径标识。</p>
<p>注意：ZooKeeper
不使用相对路径。所以以下是无效的：“/a/b/./c”或“/a/b/../c”。</p>
</blockquote>
<h2 id="节点和临时节点">3.2 节点和临时节点</h2>
<p>与标准文件系统不同，ZooKeeper
命名空间中的每个节点都可以有与其关联的数据以及子节点。这就像拥有一个允许文件也可以是目录的文件系统。（ZooKeeper
旨在存储协调数据：状态信息、配置、位置信息等，因此每个节点存储的数据通常很小，在字节到千字节范围内。）我们使用术语
znode 来<em>明确</em>我们正在谈论 ZooKeeper 数据节点。</p>
<p>Znodes 维护一个统计结构，其中包括数据更改的版本号、ACL
更改和时间戳，以允许缓存验证和协调更新。每次 znode
的数据更改时，版本号都会增加。例如，每当客户端检索数据时，它也会收到数据的版本。</p>
<p>存储在命名空间中每个 znode 的数据是原子读取和写入的。读取获取与 znode
关联的所有数据字节，写入替换所有数据。每个节点都有一个访问控制列表
(ACL)，用于限制谁可以做什么。</p>
<p>ZooKeeper 也有临时节点的概念。只要创建 znode 的会话处于活动状态，这些
znode 就会存在。当会话结束时，znode 将被删除。</p>
<h2 id="条件更新和监视">3.3 条件更新和监视</h2>
<p><em>ZooKeeper 支持watches</em>的概念。客户端可以在 znode
上设置监视。当 znode 更改时，将触发并删除
watch。触发监视时，客户端会收到一个数据包，说明 znode
已更改。如果客户端和其中一个 ZooKeeper
服务器之间的连接断开，客户端将收到本地通知。</p>
<p><strong>3.6.0 中的新增功能：</strong>客户端还可以在 znode
上设置永久的递归监视，这些监视在触发时不会被删除，并且会递归地触发已注册
znode 以及任何子 znode 上的更改。</p>
<h2 id="保证">3.4 保证</h2>
<p>ZooKeeper
非常快速且非常简单。但是，由于它的目标是成为构建更复杂服务（例如同步）的基础，因此它提供了一组保证。这些都是：</p>
<ul>
<li>顺序一致性——来自客户端的更新将按照它们发送的顺序应用。</li>
<li>原子性——更新要么成功要么失败。没有部分结果。</li>
<li>单一系统映像——无论连接到哪个服务器，客户端都将看到相同的服务视图。即，即使客户端故障转移到具有相同会话的不同服务器，客户端也永远不会看到系统的旧视图。</li>
<li>可靠性——应用更新后，它将一直持续到客户端覆盖更新为止。</li>
<li>及时性——系统的客户视图保证在特定时间范围内是最新的。</li>
</ul>
<h2 id="simple-api">3.5 Simple Api</h2>
<p>ZooKeeper
的设计目标之一是提供一个非常简单的编程接口。因此，它仅支持这些操作：</p>
<ul>
<li><em>create</em>：在树中的某个位置创建一个节点</li>
<li><em>delete</em> : 删除一个节点</li>
<li><em>exists</em> : 测试节点是否存在于某个位置</li>
<li><em>获取数据</em>：从节点读取数据</li>
<li><em>设置数据</em>：将数据写入节点</li>
<li><em>get children</em>：检索节点的子节点列表</li>
<li><em>sync</em>：等待数据传播</li>
</ul>
<h1 id="zookeeper节点">4.Zookeeper节点</h1>
<h2 id="节点的状态结构">4.1 节点的状态结构</h2>
<p>节点称为 <strong>ZNode</strong>。每个 ZNode
有一个名称标识，即树根到该节点的路径（用 “/” 分隔），ZooKeeper
树中的每个节点都可以拥有子节点，这与文件系统的目录树类似。</p>
<p>上图中，每一个节点都是一个ZNode，每个ZNode都会保存自己的数据内容和一系列属性信息，维护一个stat结构。比如上面我们创建的<code>works</code>节点：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">[zk</span>: <span class="hljs-string">localhost:2181(CONNECTED) 15] stat /works</span><br><span class="hljs-attr">cZxid</span> = <span class="hljs-string">0x4</span><br><span class="hljs-attr">ctime</span> = <span class="hljs-string">Mon Mar 06 16:07:21 CST 2023</span><br><span class="hljs-attr">mZxid</span> = <span class="hljs-string">0x4</span><br><span class="hljs-attr">mtime</span> = <span class="hljs-string">Mon Mar 06 16:07:21 CST 2023</span><br><span class="hljs-attr">pZxid</span> = <span class="hljs-string">0x7</span><br><span class="hljs-attr">cversion</span> = <span class="hljs-string">3</span><br><span class="hljs-attr">dataVersion</span> = <span class="hljs-string">0</span><br><span class="hljs-attr">aclVersion</span> = <span class="hljs-string">0</span><br><span class="hljs-attr">ephemeralOwner</span> = <span class="hljs-string">0x0</span><br><span class="hljs-attr">dataLength</span> = <span class="hljs-string">0</span><br><span class="hljs-attr">numChildren</span> = <span class="hljs-string">3</span><br><span class="hljs-attr">[zk</span>: <span class="hljs-string">localhost:2181(CONNECTED) 16]</span><br></code></pre></td></tr></table></figure>
<p>其中每个字段的含义为：</p>
<figure>
<img
src="http://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/zookeeper/Ciqc1F6zbwWAVkt5AAC_yMQVCFo712.png" srcset="/img/loading.gif" lazyload
alt="表.png" />
<figcaption aria-hidden="true">表.png</figcaption>
</figure>
<blockquote>
<p>在zookeeper中，事务是指能够改变zookeeper服务器状态的操作，称为事务操作和更新操作。一般包括数据节点的创建与删除、数据节点内容更新等操作。</p>
<p>每一次事务请求，zk都会为其分配一个全局唯一的事务id，用ZXID表示，通常是一个64位数字。每一个ZXID对应一次更新更新操作。</p>
</blockquote>
<p><strong>为什么 ZooKeeper 不能采用相对路径查找节点呢？</strong></p>
<blockquote>
<p>因为 ZooKeeper
大多是应用场景是定位数据模型上的节点，并在相关节点上进行操作。ZooKeeper
在底层实现的时候，使用了一个 hashtable，即
hashtableConcurrentHashMap&lt;String, DataNode&gt; nodes
，用节点的完整路径来作为 key 存储节点数据。这样就大大提高了 ZooKeeper
的性能。</p>
</blockquote>
<p>上述众多节点特性，使得 zookeeper
能开发不出不同的经典应用场景，比如：</p>
<ul>
<li><ol type="1">
<li>数据发布/订阅</li>
</ol></li>
<li><ol start="2" type="1">
<li>负载均衡</li>
</ol></li>
<li><ol start="3" type="1">
<li>分布式协调/通知</li>
</ol></li>
<li><ol start="4" type="1">
<li>集群管理</li>
</ol></li>
<li><ol start="5" type="1">
<li>集群管理</li>
</ol></li>
<li><ol start="6" type="1">
<li>master 管理</li>
</ol></li>
<li><ol start="7" type="1">
<li>分布式锁</li>
</ol></li>
<li><ol start="8" type="1">
<li>分布式队列</li>
</ol></li>
</ul>
<h2 id="节点类型">4.2 <strong>节点类型</strong></h2>
<p>与标准文件系统不同，ZooKeeper
命名空间中的每个节点都可以有与其关联的数据以及子节点。这就像拥有一个允许文件也可以是目录的文件系统。（ZooKeeper
旨在存储协调数据：状态信息、配置、位置信息等，因此每个节点存储的数据通常很小，在字节到千字节范围内。）我们使用术语<code>znode</code>
来<em>明确</em>我们正在谈论 ZooKeeper 数据节点。</p>
<p>Znodes 维护一个统计结构，其中包括数据更改的版本号、ACL
更改和时间戳，以允许缓存验证和协调更新。每次 znode
的数据更改时，版本号都会增加。例如，每当客户端检索数据时，它也会收到数据的版本。</p>
<p>存储在命名空间中每个 znode 的数据是原子读取和写入的。读取获取与 znode
关联的所有数据字节，写入替换所有数据。<strong>每个节点都有一个访问控制列表
(ACL)，用于限制谁可以做什么</strong>。</p>
<p>ZooKeeper 由节点来存储信息，ZooKeeper 中的数据节点也分为
<code>持久节点</code>、<code>临时节点</code>和<code>有序节点</code>三种类型：</p>
<h3 id="持久节点">4.2.1 <strong>持久节点</strong></h3>
<p>持久节点，这种节点也是在 ZooKeeper
最为常用的，持久节点一旦将节点创建为持久节点，该数据节点会一直存储在
ZooKeeper
服务器上，即使创建该节点的客户端与服务端的会话关闭了，该节点依然不会被删除。如果我们想删除持久节点，就要显式调用
delete 函数进行删除操作。</p>
<p>### 4.2.2 临时节点</p>
<p>ZooKeeper 也有临时节点的概念。只要创建 znode 的会话处于活动状态，这些
znode 就会存在。当会话结束时，znode 将被删除。</p>
<p>临时节点的一个最重要的特性就是临时性。所谓临时性是指，如果将节点创建为临时节点，那么该节点数据不会一直存储在
ZooKeeper
服务器上。<code>当创建该临时节点的客户端会话因超时或发生异常而关闭时，该节点也相应在 ZooKeeper 服务器上被删除</code>。同样，我们可以像删除持久节点一样主动删除临时节点。</p>
<p>在平时的开发中，我们可以利用临时节点的这一特性来做服务器集群内机器运行情况的统计，将集群设置为“/servers”节点，并为集群下的每台服务器创建一个临时节点“/servers/host”，当服务器下线时该节点自动被删除，最后统计临时节点个数就可以知道集群中的运行情况。如下图所示：</p>
<figure>
<img
src="http://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/zookeeper/CgqCHl6yL-SAb0zaAABQBLohKvo019.png" srcset="/img/loading.gif" lazyload
alt="image" />
<figcaption aria-hidden="true">image</figcaption>
</figure>
<blockquote>
<p>临时节点不允许有子节点，因为它随时可能被删除。</p>
</blockquote>
<p>### 4.2.3 有序节点</p>
<p>其实有序节点并不算是一种单独种类的节点，而是在之前提到的持久节点和临时节点特性的基础上，增加了一个节点有序的性质。所谓节点有序是说在我们创建有序节点的时候，ZooKeeper
服务器会自动使用一个单调递增的数字作为后缀，追加到我们创建节点的后边。例如一个客户端创建了一个路径为
works/task- 的有序节点，那么 ZooKeeper
将会生成一个序号并追加到该节点的路径后，最后该节点的路径为
works/task-1。通过这种方式我们可以直观的查看到节点的创建顺序。</p>
<blockquote>
<p>因此可以分为：</p>
<ul>
<li><strong>持久节点</strong>：节点被创建后会一直存在服务器，除非主动进行ZNode删除操作，主动清除。否则一直被保存</li>
<li><strong>持久顺序节点</strong>：创建节点时会在节点名后面加上一个数字后缀来表示顺序，和持久节点特性一样</li>
<li><strong>临时节点</strong>：生命周期和客户端会话绑在一起，客户端会话结束，节点会被删除；不能创建子节点</li>
<li><strong>临时顺序节点</strong>：有顺序的临时节点</li>
</ul>
</blockquote>
<p>到目前为止我们知道在 ZooKeeper 服务器上存储数据的基本信息，知道了
ZooKeeper
中的数据节点种类有持久节点和临时节点等。上述这几种数据节点虽然类型不同，但
ZooKeeper 中的每个节点都维护有这些内容：一个二进制数组（byte
data[]），用来存储节点的数据、ACL
访问控制信息、子节点数据（因为临时节点不允许有子节点，所以其子节点字段为
null），除此之外每个数据节点还有一个记录自身状态信息的字段 stat。</p>
<h1 id="zookeeper命令">5.Zookeeper命令</h1>
<p><strong>命令：</strong></p>
<p>为了后续讲解，此处只展示常用的基础命令。</p>
<ul>
<li><strong>connect host:port</strong> 连接zookeeper</li>
</ul>
<blockquote>
<p>connect 127.0.0.1:2181</p>
</blockquote>
<p>可选的“chroot”后缀也可以附加到连接字符串。这将运行客户端命令，比如我们运行：</p>
<blockquote>
<p>connect 127.0.0.1:2181/works</p>
</blockquote>
<p>其中客户端将根于此路径，所有路径都将相对于此根</p>
<ul>
<li><strong>ls</strong>
查看某个路径下目录列表，<strong>path</strong>：代表路径。</li>
</ul>
<blockquote>
<p>ls path</p>
</blockquote>
<ul>
<li><strong>ls2</strong> 查看某个路径下目录列表，它比 ls
命令列出更多的详细信息</li>
</ul>
<blockquote>
<p>ls2 path</p>
</blockquote>
<ul>
<li><strong>get</strong>
用于获取节点数据和状态信息，<strong>[watch]</strong>：对<strong>节点</strong>进行事件监听。</li>
</ul>
<blockquote>
<p>get path [watch]</p>
<p>节点监听：如果有另一个终端对该节点进行了修改，则监听此节点的终端会得到事件通知</p>
</blockquote>
<ul>
<li><strong>stat</strong> 查看节点状态信息。</li>
</ul>
<blockquote>
<p>stat path [watch]</p>
</blockquote>
<ul>
<li><strong>create</strong> 用于创建节点并赋值。</li>
</ul>
<blockquote>
<p>create [-s] [-e] path data acl</p>
</blockquote>
<ul>
<li><strong>[-s] [-e]</strong>：-s 和 -e 都是可选的，-s 代表顺序节点，
-e 代表临时节点，</li>
<li><strong>path</strong>：指定要创建节点的路径，比如
<strong>/runoob</strong>。</li>
<li><strong>data</strong>：要在此节点存储的数据。</li>
<li><strong>acl</strong>：访问权限相关，默认是
world，相当于全世界都能访问。</li>
</ul>
<p><strong>注意其中 -s 和 -e
可以同时使用的，并且临时节点不能再创建子节点。</strong></p>
<ul>
<li><strong>set</strong>
修改节点存储的数据。<strong>[version]</strong>：可选项，版本号(可用作乐观锁)。</li>
</ul>
<blockquote>
<p>set path data [version]</p>
</blockquote>
<ul>
<li><strong>delete</strong> 删除某节点</li>
</ul>
<blockquote>
<p>delete path [version]</p>
</blockquote>
<figure>
<img
src="http://nanchengjiumeng123.oss-cn-beijing.aliyuncs.com/categories/framework/zookeeper/CgqCHl6yL9uAbpHYAABF_GHyGNc950.png" srcset="/img/loading.gif" lazyload
alt="image" />
<figcaption aria-hidden="true">image</figcaption>
</figure>
<p>举例，现在我们创建上图节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: localhost:2181(CONNECTED) 0] <span class="hljs-built_in">ls</span> /<br>[zookeeper]<br>[zk: localhost:2181(CONNECTED) 1] create /locks<br>Created /locks<br>[zk: localhost:2181(CONNECTED) 2] create /works<br>Created /works<br>[zk: localhost:2181(CONNECTED) 3] create /works/test1<br>Created /works/test1<br>[zk: localhost:2181(CONNECTED) 4] create /works/test2<br>Created /works/test2<br>[zk: localhost:2181(CONNECTED) 5] create /works/test3<br>Created /works/test3<br>[zk: localhost:2181(CONNECTED) 6] <span class="hljs-built_in">ls</span> /<br>[locks, works, zookeeper]<br>[zk: localhost:2181(CONNECTED) 7]<br></code></pre></td></tr></table></figure>
<h1 id="read-more">6.Read more</h1>
<p>:lollipop::https://www.runoob.com/w3cnote/zookeeper-znode-data-model.html</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%A1%86%E6%9E%B6/" class="category-chain-item">框架</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Zookeeper/" class="print-no-link">#Zookeeper</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>zookeeper简介</div>
      <div>https://nanchengjiumeng123.top/2022/09/11/framework/zookeeper/2022-09-11_zookeeper简介/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Yang Xin</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年9月11日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/09/12/framework/zookeeper/2022-09-12_zookeeper%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" title="zookeeper启动流程">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">zookeeper启动流程</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/05/27/framework/spring/2022-05-22_Spring%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/" title="Spring循环依赖">
                        <span class="hidden-mobile">Spring循环依赖</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <span>Blog</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":200,"height":400},"mobile":{"show":true},"log":false});</script></body>
</html>
